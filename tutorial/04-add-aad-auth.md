<!-- markdownlint-disable MD002 MD041 -->

В этом упражнении вы будете расширяем приложение из предыдущего упражнения для поддержки проверки подлинности с помощью Azure AD. Это необходимо для получения необходимого маркера доступа OAuth для вызова Microsoft Graph. На этом этапе выполняется интеграция элемента управления **логинбуттон** из [элементов управления Windows Graph](https://github.com/windows-toolkit/Graph-Controls) в приложение.

1. Щелкните правой кнопкой мыши проект **графтуториал** в обозревателе решений и выберите команду **Добавить > новый элемент..**.. Выберите **файл Resources (. РеСВ)**, назовите файл `OAuth.resw` и нажмите кнопку **добавить**. Когда новый файл откроется в Visual Studio, создайте два ресурса, как показано ниже.

    - **Name:** `AppId`, **value:** идентификатор приложения, созданный на портале регистрации приложений
    - **Name:** `Scopes`, **значение:**`User.Read Calendars.Read`

    ![Снимок экрана: файл OAuth. РеСВ в редакторе Visual Studio](./images/edit-resources-01.png)

    > [!IMPORTANT]
    > Если вы используете систему управления версиями (например, Git), то теперь мы бы не могли исключить `OAuth.resw` файл из системы управления версиями, чтобы избежать случайной утечки идентификатора приложения.

## <a name="configure-the-loginbutton-control"></a>Настройка элемента управления Логинбуттон

1. Откройте `MainPage.xaml.cs` и добавьте приведенный `using` ниже оператор в начало файла.

    ```csharp
    using Microsoft.Toolkit.Graph.Providers;
    ```

1. Замените существующий конструктор приведенным ниже.

    :::code language="csharp" source="../demo/GraphTutorial/MainPage.xaml.cs" id="ConstructorSnippet":::

    Этот код загружает параметры из `OAuth.resw` и Инициализирует поставщик MSAL с этими значениями.

1. Теперь добавьте обработчик события для `ProviderUpdated` события. `ProviderManager` Добавьте к классу `MainPage` следующую функцию:

    :::code language="csharp" source="../demo/GraphTutorial/MainPage.xaml.cs" id="ProviderUpdatedSnippet":::

    Это событие инициируется при изменении поставщика или при изменении состояния поставщика.

1. В обозревателе решений разверните узел **Homepage. XAML** и откройте `HomePage.xaml.cs`его. Замените существующий конструктор приведенным ниже.

    :::code language="csharp" source="../demo/GraphTutorial/HomePage.xaml.cs" id="ConstructorSnippet":::

1. Перезапустите приложение и щелкните элемент управления **входом** в верхней части приложения. Когда вы вошли в систему, Пользовательский интерфейс должен измениться, чтобы показать, что вы успешно выполнили вход.

    ![Снимок экрана приложения после входа](./images/add-aad-auth-01.png)

    > [!NOTE]
    > `ButtonLogin` Элемент управления реализует логику сохранения и обновления маркера доступа. Маркеры хранятся в безопасном хранилище и обновляются по мере необходимости.
